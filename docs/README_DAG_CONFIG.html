

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DAG Configurations &mdash; primrose 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration Metadata" href="README_METADATA.html" />
    <link rel="prev" title="Getting Started" href="README_GETTING_STARTED.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> primrose
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_GETTING_STARTED.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DAG Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#configuration-files">Configuration Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#section-order">Section Order</a></li>
<li class="toctree-l2"><a class="reference internal" href="#node-definitions">Node Definitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#node-names">Node Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-key">Class Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#destinations-key">Destinations Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-special-required-keys">Other Special Required Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-class-specific-keys">Other Class-Specific Keys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="#configuration-file-fragment-substitution">Configuration File Fragment Substitution</a></li>
<li class="toctree-l1"><a class="reference internal" href="#configuration-file-validation">Configuration File Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#when-validation-passes">When Validation Passes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#when-validation-fails">When Validation Fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next">Next</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README_METADATA.html">Configuration Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_METADATA.html#traverser-key">traverser key</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_METADATA.html#section-registry-key">section_registry key</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_METADATA.html#section-run-key">section_run key</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_METADATA.html#data-object-key">data_object key</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_CLI.html">Primrose Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_DEVELOPER_NOTES.html">Developer Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_DATAOBJECT.html">DataObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_DATAOBJECT.html#saving-data">Saving Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_DATAOBJECT.html#getting-data">Getting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_DATAOBJECT.html#other-methods">Other methods</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">primrose</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>DAG Configurations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/README_DAG_CONFIG.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dag-configurations">
<h1>DAG Configurations<a class="headerlink" href="#dag-configurations" title="Permalink to this headline">¶</a></h1>
<p>In <code class="docutils literal notranslate"><span class="pre">primrose</span></code>, you run a job by defining a <code class="docutils literal notranslate"><span class="pre">directed</span> <span class="pre">acylic</span> <span class="pre">graph</span></code>, hereafter <code class="docutils literal notranslate"><span class="pre">DAG</span></code>, with a configuration file.</p>
<p>Graphs consists of two components:</p>
<ul>
<li><p><strong>nodes</strong>: these are the individuals steps (actually classes) that need to be run, such as a <code class="docutils literal notranslate"><span class="pre">CsvReader</span></code> or <code class="docutils literal notranslate"><span class="pre">DecisionTreeModel</span></code>.</p></li>
<li><p><strong>edges</strong>: these are the dependencies among nodes, and typically (but not always) involve a flow of data from the source node to the destination node. For instance, you may need a reader to run, and for the data to flow to a downstream writer so that it can be written out. In this case, you define an edge from the reader to a writer. All edges are directed.</p>
<p>An edge, however, may not require a data flow. For instance, a writer (which might represent the last actual work step of a DAG) might connect to a final success step to track the DAG completion. That success step might not need any data other than a signal that it is its turn to fire.</p>
</li>
</ul>
<p>Here is a very simple DAG consisting of a reader node flowing to a writer node with a single directed edge:</p>
<p><img alt="_images/simple_graph.png" src="_images/simple_graph.png" /></p>
</div>
<div class="section" id="configuration-files">
<h1>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h1>
<p>At the highest level, configuration files consists of two sections:</p>
<ul class="simple">
<li><p><strong>metadata</strong> section. This section is <em>optional</em> and contains the data that defines any global (job-level) parameters. This section is documented <a class="reference internal" href="README_METADATA.html"><span class="doc">here</span></a>.</p></li>
<li><p><strong>implementation</strong> section. This <em>required</em> section  contains the actual DAG definition.</p></li>
</ul>
<p>This is the highest level skeleton of a configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The typical flow of a machine learning job is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readers</span> <span class="o">--&gt;</span> <span class="n">pipelines</span> <span class="o">--&gt;</span> <span class="n">models</span> <span class="o">--&gt;</span> <span class="n">postprocess</span> <span class="o">--&gt;</span> <span class="n">writers</span> <span class="o">--&gt;</span> <span class="n">success</span>
</pre></div>
</div>
<p>and so configuration files tend to gather nodes of a particular type into a section. Readers are defined within a <code class="docutils literal notranslate"><span class="pre">reader_config</span></code> section, pipelines nodes are defined within a <code class="docutils literal notranslate"><span class="pre">pipeline_config</span></code> section etc.</p>
<p>Importantly, these sections are optional. That is, you can have 0 or 1 of each of <code class="docutils literal notranslate"><span class="pre">reader_config</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_config</span></code>, <code class="docutils literal notranslate"><span class="pre">model_config</span></code>, <code class="docutils literal notranslate"><span class="pre">postprocess_config</span></code>, <code class="docutils literal notranslate"><span class="pre">writer_config</span></code>, and <code class="docutils literal notranslate"><span class="pre">success_config</span></code>.</p>
<p>Here is an example configuration consisting of a single reader node flowing into a writer node. There is a single <code class="docutils literal notranslate"><span class="pre">reader_config</span></code> and a single <code class="docutils literal notranslate"><span class="pre">writer_config</span></code> and no other sections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;write_output&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you wish to have sections other than <code class="docutils literal notranslate"><span class="pre">reader_config</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_config</span></code>, <code class="docutils literal notranslate"><span class="pre">model_config</span></code>, <code class="docutils literal notranslate"><span class="pre">postprocess_config</span></code>, <code class="docutils literal notranslate"><span class="pre">writer_config</span></code>, or <code class="docutils literal notranslate"><span class="pre">success_config</span></code>, you can do so but you will need to register them in the metadata section. Please see <a class="reference internal" href="README_METADATA.html"><span class="doc">Configuration Metadata</span></a> for full details.</p>
<div class="section" id="section-order">
<h2>Section Order<a class="headerlink" href="#section-order" title="Permalink to this headline">¶</a></h2>
<p>The order of the sections within <code class="docutils literal notranslate"><span class="pre">implementation_config</span></code> is not important and does not impact the order of operations. Thus,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;write_output&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>is valid and defines the same DAG—a reader flowing to a writer—as the earlier example. This is true because the edges are all directed. What defines the DAG is not the sections but the nodes and directed edges, the underlying graph, here <code class="docutils literal notranslate"><span class="pre">read_data</span> <span class="pre">node</span> <span class="pre">--&gt;</span> <span class="pre">write_output</span> <span class="pre">node</span></code>.</p>
</div>
<div class="section" id="node-definitions">
<h2>Node Definitions<a class="headerlink" href="#node-definitions" title="Permalink to this headline">¶</a></h2>
<p>In the example above, we defined two DAG nodes: a reader node and a writer node. Let’s examine the <code class="docutils literal notranslate"><span class="pre">reader_config</span></code> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="o">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="node-names">
<h3>Node Names<a class="headerlink" href="#node-names" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">reader_config</span></code> (and is true of all sections) is a dictionary. Its keys are the names of the nodes. Thus, within <code class="docutils literal notranslate"><span class="pre">reader_config</span></code> we have a single key, <code class="docutils literal notranslate"><span class="pre">read_data</span></code>. So, we have one DAG node in <code class="docutils literal notranslate"><span class="pre">reader_config</span></code> and it is called <code class="docutils literal notranslate"><span class="pre">read_data</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">read_data</span></code> node defines a dictionary. All nodes are defined by dictionaries.</p>
</div>
<div class="section" id="class-key">
<h3>Class Key<a class="headerlink" href="#class-key" title="Permalink to this headline">¶</a></h3>
<p>Every node definition <em>must</em> contain a class key. This defines the string, typically the class name, that is registered with the <code class="docutils literal notranslate"><span class="pre">NodeFactory</span></code>, and specifies which class we wish to run at this point in the DAG.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="destinations-key">
<h3>Destinations Key<a class="headerlink" href="#destinations-key" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">read_data</span></code> also specifies a list <code class="docutils literal notranslate"><span class="pre">destinations</span></code>. This is the key that specifies the edges. Destinations, as the name suggests, is the list of other node names, that data from this node should flow to.</p>
<p>In the example above <code class="docutils literal notranslate"><span class="pre">read_data</span></code> specifies that it has an edge connecting to the node named <code class="docutils literal notranslate"><span class="pre">write_output</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;write_output&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">destinations</span></code> may be an empty list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>or it may be missing completely, as in the <code class="docutils literal notranslate"><span class="pre">write_output</span></code> node above.</p>
<p>As you might expect, the names listed within the <code class="docutils literal notranslate"><span class="pre">destinations</span></code> list must be valid names of nodes within the DAG. Moreover, they must not be node names that would create cycles within the graph.</p>
<p>For instance, this would <strong>not</strong> be a valid DAG:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="o">...</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;write_output&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="o">...</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;read_data&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>as <code class="docutils literal notranslate"><span class="pre">read_data</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">write_output</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">read_data</span></code> is a cycle.</p>
</div>
<div class="section" id="other-special-required-keys">
<h3>Other Special Required Keys<a class="headerlink" href="#other-special-required-keys" title="Permalink to this headline">¶</a></h3>
<p>Pipeline-type nodes require an <code class="docutils literal notranslate"><span class="pre">is_training</span></code> key with a value one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></li>
</ul>
<p>Model-type nodes require a <code class="docutils literal notranslate"><span class="pre">mode</span></code> key with a value one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">train</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval</span></code></p></li>
</ul>
</div>
<div class="section" id="other-class-specific-keys">
<h3>Other Class-Specific Keys<a class="headerlink" href="#other-class-specific-keys" title="Permalink to this headline">¶</a></h3>
<p>Nodes may define keys other than <code class="docutils literal notranslate"><span class="pre">class</span></code>, <code class="docutils literal notranslate"><span class="pre">destinations</span></code>, <code class="docutils literal notranslate"><span class="pre">is_training</span></code>, and <code class="docutils literal notranslate"><span class="pre">mode</span></code> that they need to fully parameterize their operation. For instance, in the <code class="docutils literal notranslate"><span class="pre">read_data</span></code> node, of type <code class="docutils literal notranslate"><span class="pre">CsvReader</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;write_output&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>we find a <code class="docutils literal notranslate"><span class="pre">filename</span></code> key. This makes sense, a <code class="docutils literal notranslate"><span class="pre">CsvReader</span></code> has to know the path to the file it must read from.</p>
<p>Each node class may define a set of additional required keys. Those are defined in the <code class="docutils literal notranslate"><span class="pre">necessary_config()</span></code> method of the class implementation. To find out which keys are needed, you can</p>
<ul class="simple">
<li><p>attempt to run the job with the configuration file and the validation process will tell you which keys are necessary but missing.</p></li>
<li><p>examine other example configuration files</p></li>
<li><p>examine the source code of the class.</p></li>
</ul>
<p>Other nodes may require many more additional fields than the single <code class="docutils literal notranslate"><span class="pre">filename</span></code> key above. For instance, in this <code class="docutils literal notranslate"><span class="pre">DecisionTreeModel</span></code>-type node, four other keys are required: <code class="docutils literal notranslate"><span class="pre">seed</span></code> (to make the job reproducible), <code class="docutils literal notranslate"><span class="pre">train_percent</span></code> (to define the train-test split percentage), <code class="docutils literal notranslate"><span class="pre">y</span></code> (the target or dependent variable), and <code class="docutils literal notranslate"><span class="pre">X</span></code> (the features that define the feature matrix).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;decision_tree_model&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;DecisionTreeModel&quot;</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s2">&quot;train_percent&quot;</span><span class="p">:</span> <span class="mf">65.0</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;play&quot;</span><span class="p">,</span>
        <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;outlook&quot;</span><span class="p">,</span>
            <span class="s2">&quot;temp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;humidity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;windy&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;precict&quot;</span><span class="p">,</span>
        <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;write_output&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Nodes may require other keys that are not required but are optional. For those keys, you will need to examine other configuration files or examine the source code.</p>
</div>
</div>
</div>
<div class="section" id="comments">
<h1>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">primrose</span></code> supports javascript style comments in the configuration files. By making use of the <code class="docutils literal notranslate"><span class="pre">jstyleson</span></code> library, it supports <code class="docutils literal notranslate"><span class="pre">/*...*/</span></code> and <code class="docutils literal notranslate"><span class="pre">//</span></code> style comments:</p>
<ul class="simple">
<li><p>single-line comment</p></li>
<li><p>multi-line comment</p></li>
<li><p>inline comment</p></li>
<li><p>trailing comma</p></li>
</ul>
<p>Thus,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="o">/*</span>
     <span class="o">*</span>  <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">comment</span>
     <span class="o">*/</span>

    <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;write_output&quot;</span>   <span class="o">/*</span> <span class="n">more</span> <span class="n">comments</span> <span class="o">*/</span>
                <span class="p">]</span>
            <span class="p">}</span>   
        <span class="p">},</span>
        <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span> <span class="o">//</span> <span class="n">an</span> <span class="n">inline</span> <span class="n">comment</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will be parsed correctly as a JSON configuration.</p>
</div>
<div class="section" id="configuration-file-fragment-substitution">
<h1>Configuration File Fragment Substitution<a class="headerlink" href="#configuration-file-fragment-substitution" title="Permalink to this headline">¶</a></h1>
<p>There are times when you may have a section of a configuration file that represents some coherent chunk of functionality that you would like to reuse in multiple configurations. <code class="docutils literal notranslate"><span class="pre">primrose</span></code> supports the ability to bring in that configuration fragment using string substitution.</p>
<p>It looks for the presence of <code class="docutils literal notranslate"><span class="pre">$$FILE=some/path/to/configuration/fragment.json$$</span></code> in your file.</p>
<p>This is more easily explained with an example.</p>
<p>Suppose you have the following configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    {
        $$FILE=test/metadata_fragment.json$$
        &quot;implementation_config&quot;: {
            $$FILE= test/read_write_fragment.json $$
        }
    }
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">test/metadata_fragment.json</span></code> is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="s2">&quot;metadata&quot;</span><span class="p">:{},</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">test/read_write_fragment.json</span></code> is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>            <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;write_output&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">primrose</span></code> will swap <code class="docutils literal notranslate"><span class="pre">$$FILE=test/metadata_fragment.json$$</span></code> with the contents of <code class="docutils literal notranslate"><span class="pre">test/metadata_fragment.json</span></code> and it will swap <code class="docutils literal notranslate"><span class="pre">$$FILE=</span> <span class="pre">config/read_write_fragment.json</span> <span class="pre">$$</span></code> with the contents of <code class="docutils literal notranslate"><span class="pre">config/read_write_fragment.json</span></code> to produce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:{},</span>
        <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;write_output&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Note: the final configuration will go through the normal validation process (see below) and it is up to the user to make sure that the destinations listed in the fragments line up with the rest of the configuration correctly.</p>
</div>
<div class="section" id="configuration-file-validation">
<h1>Configuration File Validation<a class="headerlink" href="#configuration-file-validation" title="Permalink to this headline">¶</a></h1>
<p>When you run, or attempt to run, a job using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">primrose</span> <span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>a validation process kicks in to validate as much of the configuration file as possible.</p>
<p>The list below is not exhaustive but, for instance, this process will check:</p>
<ul class="simple">
<li><p>that a single <code class="docutils literal notranslate"><span class="pre">implementation_config</span></code> key exists</p></li>
<li><p>that it recognizes the sections (either they are the default <code class="docutils literal notranslate"><span class="pre">reader_config</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_config</span></code> etc. or they are user-defined sections registered in the metadata section)</p></li>
<li><p>that node names are unique</p></li>
<li><p>that each node contains a <code class="docutils literal notranslate"><span class="pre">class</span></code> key</p></li>
<li><p>that the value specified for <code class="docutils literal notranslate"><span class="pre">class</span></code> key is a recognized, registered class</p></li>
<li><p>that the required additional keys for a node are present</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">destinations</span></code> point to known node names</p></li>
<li><p>that the DAG does not have cycles</p></li>
<li><p>that if a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> section is present, it meets a set of requirements. See <a class="reference internal" href="README_METADATA.html"><span class="doc">Configuration Metadata</span></a> for details on its keys.</p></li>
</ul>
<div class="section" id="when-validation-passes">
<h2>When Validation Passes<a class="headerlink" href="#when-validation-passes" title="Permalink to this headline">¶</a></h2>
<p>When you run the job, the job will log the checks being made, such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primrose</span> <span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">config</span><span class="o">/</span><span class="n">hello_world_read_write</span><span class="o">.</span><span class="n">json</span>

<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">601</span> <span class="n">INFO</span> <span class="n">configuration</span><span class="o">.</span><span class="n">py</span> <span class="fm">__init__</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">config</span> <span class="n">file</span> <span class="n">at</span> <span class="n">config</span><span class="o">/</span><span class="n">hello_world_read_write</span><span class="o">.</span><span class="n">json</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">601</span> <span class="n">INFO</span> <span class="n">configuration</span><span class="o">.</span><span class="n">py</span> <span class="n">check_sections</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="nb">all</span> <span class="n">sections</span> <span class="n">are</span> <span class="n">supported</span> <span class="n">operations</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration</span><span class="o">.</span><span class="n">py</span> <span class="n">check_config</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="nb">all</span> <span class="k">class</span> <span class="nc">keys</span> <span class="n">are</span> <span class="n">present</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration</span><span class="o">.</span><span class="n">py</span> <span class="n">check_config</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="nb">all</span> <span class="n">classes</span> <span class="n">recognized</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration</span><span class="o">.</span><span class="n">py</span> <span class="n">check_config</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="n">good</span> <span class="n">necessary_configs</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration_dag</span><span class="o">.</span><span class="n">py</span> <span class="n">create_dag</span><span class="p">:</span> <span class="n">Checking</span> <span class="n">configuration</span> <span class="n">DAG</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration_dag</span><span class="o">.</span><span class="n">py</span> <span class="n">create_dag</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="n">good</span> <span class="n">referential</span> <span class="n">integrity</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration_dag</span><span class="o">.</span><span class="n">py</span> <span class="n">check_connected_components</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="mi">1</span> <span class="n">connected</span> <span class="n">component</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">20</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">configuration_dag</span><span class="o">.</span><span class="n">py</span> <span class="n">check_for_cycles</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span> <span class="n">no</span> <span class="n">cycles</span> <span class="n">found</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="when-validation-fails">
<h2>When Validation Fails<a class="headerlink" href="#when-validation-fails" title="Permalink to this headline">¶</a></h2>
<p>If any checks fail, the job will fail with fairly explicit error messages that will specify what is wrong with the configuration file.</p>
<p>For instance, for this configuration with a destination <code class="docutils literal notranslate"><span class="pre">xxx</span></code> that does not exist,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;implementation_config&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;reader_config&quot;</span><span class="p">:</span> <span class="p">{</span>
           <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvReader&quot;</span><span class="p">,</span>
               <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;data/tennis.csv&quot;</span><span class="p">,</span>
               <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                   <span class="s2">&quot;xxx&quot;</span>
               <span class="p">]</span>
           <span class="p">}</span>
       <span class="p">},</span>
       <span class="s2">&quot;writer_config&quot;</span><span class="p">:</span> <span class="p">{</span>
           <span class="s2">&quot;write_output&quot;</span><span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;CsvWriter&quot;</span><span class="p">,</span>
               <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span>
               <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;tennis_output.csv&quot;</span>
           <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">xxx</span></code> is not a node name in the graph.</p>
<p>It will fail with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primrose</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span> <span class="n">Did</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">xxx</span> <span class="n">destination</span> <span class="ow">in</span> <span class="n">reader_config</span><span class="o">.</span><span class="n">read_data</span>
</pre></div>
</div>
</div>
<div class="section" id="next">
<h2>Next<a class="headerlink" href="#next" title="Permalink to this headline">¶</a></h2>
<p>Read more about the metadata featues of Configurations: <a class="reference internal" href="README_METADATA.html"><span class="doc">Configuration Metadata</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="README_METADATA.html" class="btn btn-neutral float-right" title="Configuration Metadata" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="README_GETTING_STARTED.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, WW International, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>